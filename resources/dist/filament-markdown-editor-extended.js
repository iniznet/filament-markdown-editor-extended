var A=new Set(["align-left","align-center","align-right","align-justify","spoiler","curator","format-paragraphs"]),F={bold:"Bold",italic:"Italic",strike:"Strikethrough",link:"Link",heading:"Heading",blockquote:"Blockquote",codeBlock:"Code block",bulletList:"Bullet list",orderedList:"Numbered list"},T={bold:{prefix:"**",suffix:"**"},italic:{prefix:"*",suffix:"*"},strike:{prefix:"~~",suffix:"~~"},link:{prefix:"[",suffix:"](url)"},heading:{prefix:"# ",suffix:""},blockquote:{prefix:"> ",suffix:""},codeBlock:{prefix:"```\n",suffix:"\n```"},bulletList:{prefix:"- ",suffix:""},orderedList:{prefix:"1. ",suffix:""},alignLeft:{prefix:`:::align-left
`,suffix:`
:::`},alignCenter:{prefix:`:::align-center
`,suffix:`
:::`},alignRight:{prefix:`:::align-right
`,suffix:`
:::`},alignJustify:{prefix:`:::align-justify
`,suffix:`
:::`},spoiler:{prefix:"||",suffix:"||"}},S={alignLeft:e=>m(e,"align-left",f(e,"align_left","Align left")),alignCenter:e=>m(e,"align-center",f(e,"align_center","Align center")),alignRight:e=>m(e,"align-right",f(e,"align_right","Align right")),alignJustify:e=>m(e,"align-justify",f(e,"align_justify","Justify")),spoiler:e=>({name:"spoiler",className:"markdown-editor-extended-icon markdown-editor-extended-spoiler",title:f(e,"spoiler","Spoiler"),action:()=>J(e)}),curator:e=>({name:"curator",className:"markdown-editor-extended-icon markdown-editor-extended-curator",title:f(e,"curator","Insert media"),action:()=>X(e)}),formatParagraphs:e=>({name:"format-paragraphs",className:"markdown-editor-extended-icon markdown-editor-extended-format-paragraphs",title:f(e,"format_paragraphs","Convert line breaks to paragraphs"),action:()=>V(e)})};function f(e,n,o){return(e?.extendedTranslations?.tools??e?.extendedTranslations??{})[n]??o}function m(e,n,o){return{name:n,className:`markdown-editor-extended-icon markdown-editor-extended-${n}`,title:o,action:()=>D(e,`:::${n}`)}}function P(e){if(document.getElementById("markdown-editor-extended-icons"))return;let n=document.createElement("style");n.id="markdown-editor-extended-icons",n.textContent=v(j(e)),document.head.appendChild(n)}function v(e){let n=".editor-toolbar",o=`
${n} a.markdown-editor-extended-icon,
${n} button.markdown-editor-extended-icon {
    position: relative;
    text-indent: -9999px;
}

${n} a.markdown-editor-extended-icon::before,
${n} button.markdown-editor-extended-icon::before {
    content: '';
    display: inline-block;
    width: 1.1rem;
    height: 1.1rem;
    background-color: currentColor;
    mask-repeat: no-repeat;
    mask-position: center;
    mask-size: 1.1rem;
}
`,t=Object.entries(e).map(([r,i])=>{let a=B(n,r),s=L(i);return!a||!s?"":`
${a}::before {
    -webkit-mask-image: url('${s}');
    mask-image: url('${s}');
}
`}).filter(Boolean).join(`
`);return`${o}
${t}`}function R(e){return`data:image/svg+xml,${encodeURIComponent(e.replace(/\s+/g," ").trim()).replace(/'/g,"%27").replace(/\(/g,"%28").replace(/\)/g,"%29")}`}function B(e,n){return n?n.startsWith(".")||n.startsWith("#")||n.includes(" ")?`${e} ${n}`:A.has(n)?`${e} .markdown-editor-extended-${n}`:`${e} .${n}`:null}function L(e){if(!e||typeof e!="string")return null;let n=e.trim();return n.startsWith("<svg")?R(n):n}function j(e){return e?.extendedIcons??{}}function D(e,n){let o=h(e);if(!o?.codemirror)return;let t=o.codemirror,r=t.getDoc(),i=r.getSelection(),s=`${n}
${i||""}
:::`;if(r.replaceSelection(s),!i){let d=r.getCursor();r.setCursor({line:d.line-1,ch:n.length})}t.focus()}function N(e){if(!e||e.__markdownEditorExtendedPatched||typeof e.getToolbarButton!="function")return e;if(typeof e.init=="function"&&!e.__markdownEditorExtendedInitPatched){let o=e.init.bind(e);e.init=async function(...t){await o(...t),z(e)},e.__markdownEditorExtendedInitPatched=!0}P(e);let n=e.getToolbarButton.bind(e);return e.getToolbarButton=function(o){let t=U(e,o);return t?W(e,o,t):S[o]?S[o](e):n(o)},e.__markdownEditorExtendedPatched=!0,e}function z(e){if(!e?.editor||e.editor.options?.previewRender?.__markdownEditorExtended)return;let n=e.editor.options?.previewRender?.bind(e.editor)??(t=>e.editor.markdown(t)),o=t=>{let r=O(t,e.extendedSyntax??{});return n(r)};o.__markdownEditorExtended=!0,e.editor.options.previewRender=o}function O(e,n){let o=e;return Object.entries(T).forEach(([t,r])=>{let i=n?.[t];if(!i||typeof i!="object")return;let a=i.prefix??"",s=i.suffix??"";if(a===r.prefix&&s===r.suffix||!a&&!s)return;let d=new RegExp(`${y(a)}([\\s\\S]*?)${y(s)}`,"g");o=o.replace(d,`${r.prefix}$1${r.suffix}`)}),o}function y(e){return e.replace(/[.*+?^${}()|[\\]\\]/g,"\\$&")}function U(e,n){return(e?.extendedSyntax??{})?.[n]??null}function W(e,n,o){let t=M(o),r=t.title??F[n]??n;return{name:n,className:n,title:r,action:()=>q(e,t)}}function M(e){return typeof e=="string"?{prefix:e,suffix:e}:!e||typeof e!="object"?{prefix:"",suffix:""}:{prefix:e.prefix??"",suffix:e.suffix??"",title:e.title??null}}function q(e,n){let o=h(e);if(!o?.codemirror)return;let t=o.codemirror,r=t.getDoc(),i=r.getSelection(),a=r.getCursor("from"),s=r.indexFromPos(a),d=`${n.prefix}${i||""}${n.suffix}`;if(r.replaceSelection(d),!i){let l=s+n.prefix.length;r.setSelection(r.posFromIndex(l),r.posFromIndex(l))}t.focus()}function h(e){return e?.editor??e}function J(e){let n=h(e);if(!n?.codemirror)return;let o=n.codemirror,t=o.getDoc(),r="||",i="||",a=t.somethingSelected(),s=t.getCursor("from"),d=t.getCursor("to"),l=t.indexFromPos(s),c=t.indexFromPos(d);if(a){let u=t.getSelection(),p=u.startsWith(r)&&u.endsWith(i)&&u.length>=r.length+i.length,w=l>=r.length?t.getRange(t.posFromIndex(l-r.length),s):"",C=t.getRange(d,t.posFromIndex(c+i.length)),I=w===r&&C===i;if(p){let g=u.slice(r.length,u.length-i.length);t.replaceRange(g,s,d);let x=l+g.length;t.setSelection(s,t.posFromIndex(x))}else if(I){let g=t.posFromIndex(c),x=t.posFromIndex(c+i.length);t.replaceRange("",g,x);let k=t.posFromIndex(l-r.length);t.replaceRange("",k,s);let b=l-r.length,_=c-r.length;t.setSelection(t.posFromIndex(b),t.posFromIndex(_))}else{let g=`${r}${u}${i}`;t.replaceRange(g,s,d);let x=t.posFromIndex(l+r.length),k=t.posFromIndex(l+r.length+u.length);t.setSelection(x,k)}}else{let u="spoiler",p=`${r}${u}${i}`;t.replaceRange(p,s);let $=t.posFromIndex(l+r.length),w=t.posFromIndex(l+r.length+u.length);t.setSelection($,w)}o.focus()}function V(e){let n=h(e);if(!n?.codemirror)return;let o=n.codemirror,t=o.getDoc(),r=t.somethingSelected(),i,a,s;r?(i=t.getSelection(),a=t.getCursor("from"),s=t.getCursor("to")):(i=t.getValue(),a={line:0,ch:0},s={line:t.lineCount()-1,ch:t.getLine(t.lineCount()-1).length});let d=i.replace(/\n{3,}/g,`

`).replace(/([^\n])\n(?!\n)(?![-*+#>\d`|])/g,`$1

`);r?t.replaceRange(d,a,s):t.setValue(d),o.focus()}function E(){let e=window.Alpine;if(!e||e.data.__markdownEditorExtendedPatched)return!!e;let n=e.data.bind(e);return e.data=function(o,t){return o!=="markdownEditorFormComponent"?n(o,t):n(o,function(...r){let i=t(...r);return N(i)})},e.data.__markdownEditorExtendedPatched=!0,!0}E()||document.addEventListener("alpine:init",()=>{E()},{once:!0});function X(e){let n=e.$wire,o=e.$root;if(!n){console.warn("Curator: $wire not found on component");return}if(!o){console.warn("Curator: $root not found on component");return}let t=o.id;if(!t){console.warn("Curator: Could not determine component key from $root.id");return}let r=`curator-panel-${t.replace(/\./g,"-")}`;window.dispatchEvent(new CustomEvent("open-modal",{detail:{id:r}}))}document.addEventListener("markdown-curator-insert",e=>{let n=e.detail;Array.isArray(n)&&(n=n[0]);let{key:o}=n||{},t=n?.media;if(Array.isArray(t)&&t.length>0&&t[0]?.media&&Array.isArray(t[0].media)&&(t=t[0].media),!o){console.warn("Curator: Missing key in event detail");return}if(!t||Array.isArray(t)&&t.length===0){console.warn("Curator: Missing media in event detail");return}if(!window.Alpine){console.warn("Curator: Alpine not found");return}let r=document.getElementById(o);if(!r){console.warn("Curator: Could not find editor element with id:",o);return}try{let a=window.Alpine.$data(r)?.editor;if(a&&a.codemirror){let s=a.codemirror,l=(Array.isArray(t)?t:[t]).map(c=>{let u=c.url||c.large_url||c.medium_url||c.thumbnail_url;return`![${c.alt||c.title||c.pretty_name||c.name||""}](${u})`}).join(`
`);s.replaceSelection(l),s.focus()}else console.warn("Curator: Could not find codemirror instance")}catch(i){console.error("Curator: Error inserting media",i)}});
