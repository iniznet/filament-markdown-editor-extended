var F=new Set(["align-left","align-center","align-right","align-justify","spoiler","curator","format-paragraphs"]),v={bold:"Bold",italic:"Italic",strike:"Strikethrough",link:"Link",heading:"Heading",blockquote:"Blockquote",codeBlock:"Code block",bulletList:"Bullet list",orderedList:"Numbered list"},T={bold:{prefix:"**",suffix:"**"},italic:{prefix:"*",suffix:"*"},strike:{prefix:"~~",suffix:"~~"},link:{prefix:"[",suffix:"](url)"},heading:{prefix:"# ",suffix:""},blockquote:{prefix:"> ",suffix:""},codeBlock:{prefix:"```\n",suffix:"\n```"},bulletList:{prefix:"- ",suffix:""},orderedList:{prefix:"1. ",suffix:""},alignLeft:{prefix:`:::align-left
`,suffix:`
:::`},alignCenter:{prefix:`:::align-center
`,suffix:`
:::`},alignRight:{prefix:`:::align-right
`,suffix:`
:::`},alignJustify:{prefix:`:::align-justify
`,suffix:`
:::`},spoiler:{prefix:"||",suffix:"||"}},S={alignLeft:e=>w(e,"align-left",f(e,"align_left","Align left")),alignCenter:e=>w(e,"align-center",f(e,"align_center","Align center")),alignRight:e=>w(e,"align-right",f(e,"align_right","Align right")),alignJustify:e=>w(e,"align-justify",f(e,"align_justify","Justify")),spoiler:e=>({name:"spoiler",className:"markdown-editor-extended-icon markdown-editor-extended-spoiler",title:f(e,"spoiler","Spoiler"),action:()=>V(e)}),curator:e=>({name:"curator",className:"markdown-editor-extended-icon markdown-editor-extended-curator",title:f(e,"curator","Insert media"),action:()=>Y(e)}),formatParagraphs:e=>({name:"format-paragraphs",className:"markdown-editor-extended-icon markdown-editor-extended-format-paragraphs",title:f(e,"format_paragraphs","Convert line breaks to paragraphs"),action:()=>X(e)})};function f(e,n,r){return(e?.extendedTranslations?.tools??e?.extendedTranslations??{})[n]??r}function w(e,n,r){return{name:n,className:`markdown-editor-extended-icon markdown-editor-extended-${n}`,title:r,action:()=>N(e,`:::${n}`)}}function P(e){if(document.getElementById("markdown-editor-extended-icons"))return;let n=document.createElement("style");n.id="markdown-editor-extended-icons",n.textContent=R(D(e)),document.head.appendChild(n)}function R(e){let n=".editor-toolbar",r=`
${n} a.markdown-editor-extended-icon,
${n} button.markdown-editor-extended-icon {
    position: relative;
    text-indent: -9999px;
}

${n} a.markdown-editor-extended-icon::before,
${n} button.markdown-editor-extended-icon::before {
    content: '';
    display: inline-block;
    width: 1.1rem;
    height: 1.1rem;
    background-color: currentColor;
    mask-repeat: no-repeat;
    mask-position: center;
    mask-size: 1.1rem;
}
`,t=Object.entries(e).map(([o,i])=>{let a=L(n,o),s=j(i);return!a||!s?"":`
${a}::before {
    -webkit-mask-image: url('${s}');
    mask-image: url('${s}');
}
`}).filter(Boolean).join(`
`);return`${r}
${t}`}function B(e){return`data:image/svg+xml,${encodeURIComponent(e.replace(/\s+/g," ").trim()).replace(/'/g,"%27").replace(/\(/g,"%28").replace(/\)/g,"%29")}`}function L(e,n){return n?n.startsWith(".")||n.startsWith("#")||n.includes(" ")?`${e} ${n}`:F.has(n)?`${e} .markdown-editor-extended-${n}`:`${e} .${n}`:null}function j(e){if(!e||typeof e!="string")return null;let n=e.trim();return n.startsWith("<svg")?B(n):n}function D(e){return e?.extendedIcons??{}}function N(e,n){let r=p(e);if(!r?.codemirror)return;let t=r.codemirror,o=t.getDoc(),i=o.getSelection(),s=`${n}
${i||""}
:::`;if(o.replaceSelection(s),!i){let d=o.getCursor();o.setCursor({line:d.line-1,ch:n.length})}m(e),t.focus()}function z(e){if(!e||e.__markdownEditorExtendedPatched||typeof e.getToolbarButton!="function")return e;if(typeof e.init=="function"&&!e.__markdownEditorExtendedInitPatched){let r=e.init.bind(e);e.init=async function(...t){await r(...t),O(e)},e.__markdownEditorExtendedInitPatched=!0}P(e);let n=e.getToolbarButton.bind(e);return e.getToolbarButton=function(r){let t=W(e,r);return t?M(e,r,t):S[r]?S[r](e):n(r)},e.__markdownEditorExtendedPatched=!0,e}function O(e){if(!e?.editor||e.editor.options?.previewRender?.__markdownEditorExtended)return;let n=e.editor.options?.previewRender?.bind(e.editor)??(t=>e.editor.markdown(t)),r=t=>{let o=U(t,e.extendedSyntax??{});return n(o)};r.__markdownEditorExtended=!0,e.editor.options.previewRender=r}function U(e,n){let r=e;return Object.entries(T).forEach(([t,o])=>{let i=n?.[t];if(!i||typeof i!="object")return;let a=i.prefix??"",s=i.suffix??"";if(a===o.prefix&&s===o.suffix||!a&&!s)return;let d=new RegExp(`${E(a)}([\\s\\S]*?)${E(s)}`,"g");r=r.replace(d,`${o.prefix}$1${o.suffix}`)}),r}function E(e){return e.replace(/[.*+?^${}()|[\\]\\]/g,"\\$&")}function W(e,n){return(e?.extendedSyntax??{})?.[n]??null}function M(e,n,r){let t=q(r),o=t.title??v[n]??n;return{name:n,className:n,title:o,action:()=>J(e,t)}}function q(e){return typeof e=="string"?{prefix:e,suffix:e}:!e||typeof e!="object"?{prefix:"",suffix:""}:{prefix:e.prefix??"",suffix:e.suffix??"",title:e.title??null}}function J(e,n){let r=p(e);if(!r?.codemirror)return;let t=r.codemirror,o=t.getDoc(),i=o.getSelection(),a=o.getCursor("from"),s=o.indexFromPos(a),d=`${n.prefix}${i||""}${n.suffix}`;if(o.replaceSelection(d),!i){let l=s+n.prefix.length;o.setSelection(o.posFromIndex(l),o.posFromIndex(l))}m(e),t.focus()}function p(e){return e?.editor??e}function m(e){if(!e)return;let n=p(e);if(!n)return;let r=typeof n.value=="function"?n.value():n.codemirror?.getValue();r!==void 0&&"state"in e&&(e.state=r)}function V(e){let n=p(e);if(!n?.codemirror)return;let r=n.codemirror,t=r.getDoc(),o="||",i="||",a=t.somethingSelected(),s=t.getCursor("from"),d=t.getCursor("to"),l=t.indexFromPos(s),c=t.indexFromPos(d);if(a){let u=t.getSelection(),h=u.startsWith(o)&&u.endsWith(i)&&u.length>=o.length+i.length,k=l>=o.length?t.getRange(t.posFromIndex(l-o.length),s):"",I=t.getRange(d,t.posFromIndex(c+i.length)),b=k===o&&I===i;if(h){let g=u.slice(o.length,u.length-i.length);t.replaceRange(g,s,d);let x=l+g.length;t.setSelection(s,t.posFromIndex(x))}else if(b){let g=t.posFromIndex(c),x=t.posFromIndex(c+i.length);t.replaceRange("",g,x);let $=t.posFromIndex(l-o.length);t.replaceRange("",$,s);let _=l-o.length,A=c-o.length;t.setSelection(t.posFromIndex(_),t.posFromIndex(A))}else{let g=`${o}${u}${i}`;t.replaceRange(g,s,d);let x=t.posFromIndex(l+o.length),$=t.posFromIndex(l+o.length+u.length);t.setSelection(x,$)}}else{let u="spoiler",h=`${o}${u}${i}`;t.replaceRange(h,s);let y=t.posFromIndex(l+o.length),k=t.posFromIndex(l+o.length+u.length);t.setSelection(y,k)}m(e),r.focus()}function X(e){let n=p(e);if(!n?.codemirror)return;let r=n.codemirror,t=r.getDoc(),o=t.somethingSelected(),i,a,s;o?(i=t.getSelection(),a=t.getCursor("from"),s=t.getCursor("to")):(i=t.getValue(),a={line:0,ch:0},s={line:t.lineCount()-1,ch:t.getLine(t.lineCount()-1).length});let d=i.replace(/\n{3,}/g,`

`).replace(/([^\n])\n(?!\n)(?![-*+#>\d`|])/g,`$1

`);o?t.replaceRange(d,a,s):t.setValue(d),m(e),r.focus()}function C(){let e=window.Alpine;if(!e||e.data.__markdownEditorExtendedPatched)return!!e;let n=e.data.bind(e);return e.data=function(r,t){return r!=="markdownEditorFormComponent"?n(r,t):n(r,function(...o){let i=t(...o);return z(i)})},e.data.__markdownEditorExtendedPatched=!0,!0}C()||document.addEventListener("alpine:init",()=>{C()},{once:!0});function Y(e){let n=e.$wire,r=e.$root;if(!n){console.warn("Curator: $wire not found on component");return}if(!r){console.warn("Curator: $root not found on component");return}let t=r.id;if(!t){console.warn("Curator: Could not determine component key from $root.id");return}let o=`curator-panel-${t.replace(/\./g,"-")}`;window.dispatchEvent(new CustomEvent("open-modal",{detail:{id:o}}))}document.addEventListener("markdown-curator-insert",e=>{let n=e.detail;Array.isArray(n)&&(n=n[0]);let{key:r}=n||{},t=n?.media;if(Array.isArray(t)&&t.length>0&&t[0]?.media&&Array.isArray(t[0].media)&&(t=t[0].media),!r){console.warn("Curator: Missing key in event detail");return}if(!t||Array.isArray(t)&&t.length===0){console.warn("Curator: Missing media in event detail");return}if(!window.Alpine){console.warn("Curator: Alpine not found");return}let o=document.getElementById(r);if(!o){console.warn("Curator: Could not find editor element with id:",r);return}try{let i=window.Alpine.$data(o),a=i?.editor;if(a&&a.codemirror){let s=a.codemirror,l=(Array.isArray(t)?t:[t]).map(c=>{let u=c.url||c.large_url||c.medium_url||c.thumbnail_url;return`![${c.alt||c.title||c.pretty_name||c.name||""}](${u})`}).join(`
`);s.replaceSelection(l),m(i),s.focus()}else console.warn("Curator: Could not find codemirror instance")}catch(i){console.error("Curator: Error inserting media",i)}});
